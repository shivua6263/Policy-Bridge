<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Customers - Policy Bridge</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <img src="https://images.unsplash.com/photo-1633158829585-23ba8f7c8caf?w=150&h=50&fit=crop" alt="Policy Bridge Logo" class="logo-img">
                <span class="brand-text ms-2">Policy Bridge</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarContent">
                <form class="d-flex mx-auto search-form">
                    <div class="input-group">
                        <span class="input-group-text bg-light border-end-0"><i class="fas fa-search text-muted"></i></span>
                        <input class="form-control border-start-0" type="search" placeholder="Search customers..." aria-label="Search" id="customerSearch">
                        <button class="btn btn-primary" type="submit">Search</button>
                    </div>
                </form>
                <div class="d-flex align-items-center mt-3 mt-lg-0">
                    <div class="dropdown">
                        <button class="btn btn-outline-primary dropdown-toggle" type="button" id="userDropdown" data-bs-toggle="dropdown">
                            <i class="fas fa-user me-1"></i> <span id="userNameDisplay">Agent</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="agent-dashboard.html"><i class="fas fa-tachometer-alt me-2"></i>Dashboard</a></li>
                            <li><a class="dropdown-item" href="manage-customers.html"><i class="fas fa-users me-2"></i>Manage Customers</a></li>
                            <li><a class="dropdown-item" href="commission-tracker.html"><i class="fas fa-coins me-2"></i>Commissions</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-danger" href="#" onclick="logoutUser(event)"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <section class="page-header">
        <div class="container">
            <div class="row">
                <div class="col-12 text-center text-white">
                    <h1 class="fw-bold mb-3">Manage Customers</h1>
                    <p class="lead mb-4">Add new customers and manage your client portfolio</p>
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb justify-content-center">
                            <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                            <li class="breadcrumb-item"><a href="agent-dashboard.html">Dashboard</a></li>
                            <li class="breadcrumb-item active text-white">Manage Customers</li>
                        </ol>
                    </nav>
                </div>
            </div>
        </div>
    </section>

    <section class="py-5">
        <div class="container">
            <!-- Action Buttons -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center">
                        <h4 class="mb-0">My Customers</h4>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addCustomerModal">
                            <i class="fas fa-plus me-2"></i>Add New Customer
                        </button>
                    </div>
                </div>
            </div>

            <!-- Customers Table -->
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Active Policies</th>
                                    <th>Total Premium</th>
                                    <th>Last Contact</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="customersTableBody">
                                <!-- Customer rows will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Add Customer Modal -->
    <div class="modal fade" id="addCustomerModal" tabindex="-1" aria-labelledby="addCustomerModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addCustomerModalLabel">Add New Customer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addCustomerForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="customerName" class="form-label">Full Name *</label>
                                <input type="text" class="form-control" id="customerName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="customerEmail" class="form-label">Email Address *</label>
                                <input type="email" class="form-control" id="customerEmail" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="customerPhone" class="form-label">Phone Number *</label>
                                <input type="tel" class="form-control" id="customerPhone" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="customerAddress" class="form-label">Address</label>
                                <textarea class="form-control" id="customerAddress" rows="2"></textarea>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="customerDob" class="form-label">Date of Birth</label>
                                <input type="date" class="form-control" id="customerDob">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="customerOccupation" class="form-label">Occupation</label>
                                <input type="text" class="form-control" id="customerOccupation">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="addCustomer()">Add Customer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Customer Modal -->
    <div class="modal fade" id="viewCustomerModal" tabindex="-1" aria-labelledby="viewCustomerModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="viewCustomerModalLabel">Customer Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-body text-center">
                                    <img src="https://via.placeholder.com/100" class="rounded-circle mb-3" alt="Customer Photo">
                                    <h5 id="viewCustomerName">John Doe</h5>
                                    <p class="text-muted" id="viewCustomerEmail">john@example.com</p>
                                    <p class="text-muted" id="viewCustomerPhone">+91 9876543210</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>Personal Information</h6>
                                    <p><strong>Address:</strong> <span id="viewCustomerAddress">123 Main St, Mumbai</span></p>
                                    <p><strong>Date of Birth:</strong> <span id="viewCustomerDob">1990-01-01</span></p>
                                    <p><strong>Occupation:</strong> <span id="viewCustomerOccupation">Software Engineer</span></p>
                                </div>
                                <div class="col-md-6">
                                    <h6>Policy Summary</h6>
                                    <div class="row text-center">
                                        <div class="col-4">
                                            <div class="p-2 bg-light rounded">
                                                <div class="h5 mb-0 text-primary" id="viewActivePolicies">2</div>
                                                <small class="text-muted">Active</small>
                                            </div>
                                        </div>
                                        <div class="col-4">
                                            <div class="p-2 bg-light rounded">
                                                <div class="h5 mb-0 text-success" id="viewTotalPremium">₹5,000</div>
                                                <small class="text-muted">Monthly</small>
                                            </div>
                                        </div>
                                        <div class="col-4">
                                            <div class="p-2 bg-light rounded">
                                                <div class="h5 mb-0 text-warning" id="viewTotalCoverage">₹10L</div>
                                                <small class="text-muted">Coverage</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <hr>
                            <h6>Recent Policies</h6>
                            <div id="customerPoliciesList">
                                <!-- Policies will be listed here -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Edit Customer</button>
                    <button type="button" class="btn btn-success">Create Quote</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadCustomers();
            updateUserDisplay();
        });

        // Load customers data
        function loadCustomers() {
            // Mock data - replace with actual API call
            const customers = [
                {
                    id: 1,
                    name: 'Anand C',
                    email: 'anandc@gmail.com',
                    phone: '9876543215',
                    activePolicies: 2,
                    totalPremium: '₹3,500',
                    lastContact: '2 days ago'
                },
                {
                    id: 2,
                    name: 'Aditya S',
                    email: 'adityas@gmail.com',
                    phone: '9876543216',
                    activePolicies: 1,
                    totalPremium: '₹2,000',
                    lastContact: '1 week ago'
                },
                {
                    id: 3,
                    name: 'Kalyani Pande',
                    email: 'kalyanipande@gmail.com',
                    phone: '9876543217',
                    activePolicies: 3,
                    totalPremium: '₹4,200',
                    lastContact: '3 days ago'
                }
            ];

            const tbody = document.getElementById('customersTableBody');
            tbody.innerHTML = '';

            customers.forEach(customer => {
                const row = `
                    <tr>
                        <td>${customer.name}</td>
                        <td>${customer.email}</td>
                        <td>${customer.phone}</td>
                        <td><span class="badge bg-success">${customer.activePolicies}</span></td>
                        <td>${customer.totalPremium}</td>
                        <td>${customer.lastContact}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary me-1" onclick="viewCustomer(${customer.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-success me-1" onclick="createQuote(${customer.id})">
                                <i class="fas fa-calculator"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-warning" onclick="contactCustomer(${customer.id})">
                                <i class="fas fa-phone"></i>
                            </button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        // Add new customer
        function addCustomer() {
            const form = document.getElementById('addCustomerForm');
            const formData = new FormData(form);

            const customerData = {
                name: document.getElementById('customerName').value,
                email: document.getElementById('customerEmail').value,
                phone: document.getElementById('customerPhone').value,
                address: document.getElementById('customerAddress').value,
                dateOfBirth: document.getElementById('customerDob').value,
                occupation: document.getElementById('customerOccupation').value
            };

            // Validate required fields
            if (!customerData.name || !customerData.email || !customerData.phone) {
                alert('Please fill in all required fields');
                return;
            }

            // Here you would make an API call to add the customer
            console.log('Adding customer:', customerData);

            // Close modal and refresh list
            const modal = bootstrap.Modal.getInstance(document.getElementById('addCustomerModal'));
            modal.hide();
            form.reset();
            loadCustomers();

            // Show success message
            alert('Customer added successfully!');
        }

        // View customer details
        function viewCustomer(customerId) {
            // Mock customer data - replace with actual API call
            const customerData = {
                name: 'Anand C',
                email: 'anandc@gmail.com',
                phone: '9876543215',
                address: 'Mumbai, Maharashtra',
                dob: '1995-06-15',
                occupation: 'Software Engineer',
                activePolicies: 2,
                totalPremium: '₹3,500',
                totalCoverage: '₹15L'
            };

            document.getElementById('viewCustomerName').textContent = customerData.name;
            document.getElementById('viewCustomerEmail').textContent = customerData.email;
            document.getElementById('viewCustomerPhone').textContent = customerData.phone;
            document.getElementById('viewCustomerAddress').textContent = customerData.address;
            document.getElementById('viewCustomerDob').textContent = customerData.dob;
            document.getElementById('viewCustomerOccupation').textContent = customerData.occupation;
            document.getElementById('viewActivePolicies').textContent = customerData.activePolicies;
            document.getElementById('viewTotalPremium').textContent = customerData.totalPremium;
            document.getElementById('viewTotalCoverage').textContent = customerData.totalCoverage;

            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('viewCustomerModal'));
            modal.show();
        }

        // Create quote for customer
        function createQuote(customerId) {
            window.location.href = 'quote.html?customer=' + customerId;
        }

        // Contact customer
        function contactCustomer(customerId) {
            alert('Contact functionality would open phone/email client');
        }

        // Update user display in navbar
        function updateUserDisplay() {
            const authManager = new AuthManager();
            const user = authManager.getCurrentUser();

            if (user) {
                const userNameDisplay = document.getElementById('userNameDisplay');
                if (userNameDisplay && user.name) {
                    userNameDisplay.textContent = user.name.split(' ')[0];
                }
            }
        }

        // Logout function
        function logoutUser(event) {
            event.preventDefault();

            if (confirm('Are you sure you want to logout?')) {
                const authManager = new AuthManager();
                authManager.logout();
            }
        }

        // Search functionality
        document.getElementById('customerSearch').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const rows = document.querySelectorAll('#customersTableBody tr');

            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });
    </script>
    
    <!-- Config Script -->
    <script src="config.js"></script>
    
    <script src="auth-manager.js"></script>
</body>
</html>